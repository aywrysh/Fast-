<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>فاست كوينز — بيع</title>
  <style>
    :root{
      /* ألوان مختلفة عن صفحة الشراء فقط */
      --bg:#0c0f1e; --ink:#eef2ff; --muted:#aab2d8;
      --card:#121634; --line:#232a55; --brand:#a78bfa; /* بنفسجي فاتح */
      --ok:#34d399; --warn:#f59e0b; --err:#ef4444;
      --radius:16px;
      --topbar-space:72px; /* يُضبط آليًا بالـ JS */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", Cairo, Tahoma, sans-serif;
      background:
        radial-gradient(1000px 500px at 90% -10%, rgba(168,85,247,.18), transparent 60%),
        radial-gradient(800px 400px at -10% 110%, rgba(59,130,246,.18), transparent 60%),
        var(--bg);
      color:var(--ink);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:10px;
    }
    .wrap{width:min(720px, 96vw); padding-top:var(--topbar-space);} /* يبدأ المحتوى بعد الهيدر */

    /* الهيدر مثبّت */
    .topbar{
      position:fixed; top:2px; left:50%; transform:translateX(-50%);
      width:min(720px, 96vw); z-index:1000;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15);
      backdrop-filter:saturate(140%) blur(6px);
      border-radius:14px; padding:10px 14px; margin-bottom:14px;
    }
    .topbar .title{font-weight:900; letter-spacing:.3px}
    .topbar .brand{opacity:.9; font-weight:700; color:var(--brand)}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); border-radius:var(--radius); padding:14px;}
    .grid{display:grid; gap:12px}
    @media(min-width:700px){ .grid-2{grid-template-columns:1fr 1fr} }

    label{font-size:13px; color:var(--muted)}
    .control{display:flex; align-items:center; gap:10px; background:#0e1330; border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px}
    input, select{flex:1; background:transparent; border:none; outline:none; color:var(--ink); font-size:15px}
    .select-mini{width:115px}

    .seg{display:flex; gap:8px; background:rgba(255,255,255,.05); padding:6px; border-radius:999px; width:max-content}
    .seg button{border:none; cursor:pointer; padding:8px 14px; border-radius:999px; font-weight:800; color:var(--muted); background:transparent}
    .seg button.active{background:rgba(167,139,250,.18); color:var(--ink); border:1px solid rgba(167,139,250,.45)}

    .methods{display:grid; gap:10px; grid-template-columns:repeat(auto-fit,minmax(130px,1fr))}
    .pill{cursor:pointer; padding:10px 12px; border-radius:12px; background:#0e1330; border:1px solid rgba(255,255,255,.12); text-align:center; font-weight:800}
    .pill.active{outline:2px solid var(--brand)}

    .hint{font-size:12px; color:var(--muted)}
    .row{display:grid; gap:8px}

    .box{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:12px}

    .toggle{display:flex; gap:8px}
    .toggle .opt{flex:1; text-align:center; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.12); cursor:pointer}
    .toggle .opt.active{background:rgba(167,139,250,.18); border-color:rgba(167,139,250,.45)}

    .actions{display:flex; gap:10px; flex-wrap:wrap}
    .btn{border:none; cursor:pointer; border-radius:12px; padding:12px 16px; font-weight:900}
    .btn.primary{background:var(--brand); color:#130a2a}
    .btn.ghost{background:rgba(255,255,255,.06); color:var(--ink); border:1px solid rgba(255,255,255,.12)}
    .btn.ok{background:var(--ok); color:#062015}
    .btn.warn{background:var(--warn); color:#1d1201}
    .btn.err{background:var(--err); color:#280404}

    .error{border-color:rgba(239,68,68,.65)!important; box-shadow:0 0 0 2px rgba(239,68,68,.25) inset}
    .ok{border-color:rgba(52,211,153,.5)!important}

    .share{display:none; gap:8px; margin-top:8px}

    footer{opacity:.75; font-size:12px; text-align:center; margin-top:14px}

    /* أرقام إنجليزية في الإجمالي */
    #totalOut{direction:ltr; unicode-bidi:plaintext;}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- هيدر ثابت -->
   
    <!-- مُباعد لمنع تغطية أول حقل -->
    <div id="tbSpacer" style="height:var(--topbar-space);"></div>

    <div class="card grid">
      <!-- الاسم + الهاتف -->
      <div class="grid grid-2">
        <div class="row">
          <label>الاسم الكامل</label>
          <div class="control"><input id="name" type="text" placeholder="اكتب اسمك" /></div>
        </div>
        <div class="row">
          <label>رقم الهاتف</label>
          <div class="control">
            <select id="cc" class="select-mini">
              <option value="+967" selected>+967 (Yemen)</option>
              <option value="+966">+966 (Saudi)</option>
              <option value="+971">+971 (UAE)</option>
              <option value="+1">+1 (USA)</option>
            </select>
            <input id="phone" type="tel" inputmode="numeric" placeholder="7xxxxxxxx" />
          </div>
        </div>
      </div>

      <!-- اختيار العملة (المقابل) + المبلغ بالـ USDT -->
      <div class="grid grid-2">
        <div class="row">
          <label>اختيار العملة (المقابل)</label>
          <div class="seg" id="fiatSeg">
            <button type="button" class="active" data-cur="YER">ريال يمني</button>
            <button type="button" data-cur="SAR">ريال سعودي</button>
            <button type="button" data-cur="USD">دولار أمريكي</button>
          </div>
        </div>
        <div class="row">
          <label>المبلغ (USDT)</label>
          <div class="control"><input id="amount" type="text" inputmode="decimal" placeholder="USDT ادخل المبلغ" /></div>
        </div>
      </div>

      <!-- الإجمالي التلقائي -->
      <div class="row">
        <label>الإجمالي</label>
        <div class="control"><input id="totalOut" type="text" readonly placeholder="—" /></div>
      </div>

      <!-- اختيار طريقة التحويل -->
      <div class="row">
        <label>اختيار طريقة التحويل</label>
        <div class="methods" id="methods">
          <div class="pill" data-method="جوالي">جوالي</div>
          <div class="pill" data-method="جيب">جيب</div>
          <div class="pill" data-method="ONEكاش">ONEكاش</div>
          <div class="pill" data-method="كاش">كاش</div>
          <div class="pill" data-method="فلوسك">فلوسك</div>
          <div class="pill" data-method="تحويل مصرفي">تحويل مصرفي</div>
          <div class="pill" data-method="كريمي">كريمي</div>
          <div class="pill" data-method="حوالة محلي">حوالة محلي</div>
        </div>
        <div class="hint">اختر طريقة واحدة فقط.</div>
      </div>

      <!-- مربعات ديناميكية -->
      <div class="row" id="dynamicBox" style="display:none"></div>

      <div class="row">
        <label>تأكيد الحالة</label>
        <div class="actions">
          <button class="btn ok" id="markPaid">تم التحويل</button>
          <button class="btn primary" id="complete">إكمال المعاملة</button>
        </div>
        <div class="share" id="shareBox">
          <button class="btn ghost" id="waWorkers">اكمال
          </button
          <button class="btn warn" id="copyMsg">نسخ التفاصيل</button>
        </div>
      </div>
    </div>

    <footer>© <span id="y"></span> Fast Coins — بيع</footer>
  </div>

  <script>
    const y = document.getElementById('y'); y.textContent = new Date().getFullYear();

    // حساب مساحة تحت الهيدر
    function fixTopbarSpace(){
      const tb = document.getElementById('topbar');
      const spacer = document.getElementById('tbSpacer');
      const wrap = document.querySelector('.wrap');
      if(!tb || !spacer || !wrap) return;
      const mb = parseFloat(getComputedStyle(tb).marginBottom) || 0;
      const space = tb.getBoundingClientRect().height + mb + 6;
      spacer.style.height = space + 'px';
      wrap.style.setProperty('--topbar-space', space + 'px');
    }
    window.addEventListener('load', fixTopbarSpace);
    window.addEventListener('resize', fixTopbarSpace);

    // اختيار العملة
    let currency = 'YER';
    const fiatSeg = document.getElementById('fiatSeg');
    fiatSeg.addEventListener('click', (e)=>{
      const b = e.target.closest('button'); if(!b) return;
      [...fiatSeg.children].forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); currency = b.dataset.cur;
      compute();
    });

    // تحويل أرقام عربية إلى إنجليزية + دعم الفاصلة العربية والإنجليزية
    const AR = '٠١٢٣٤٥٦٧٨٩';
    function normalizeNumber(s){
      if(!s) return 0;
      // استبدال الأرقام العربية
      s = s.replace(/[٠-٩]/g, ch => String(AR.indexOf(ch)));
      // تحويل الفاصلة العربية أو الإنجليزية إلى نقطة
      s = s.replace(/[،,]/g, '.');
      // إزالة أي شيء ماعدا الأرقام والنقطة
      s = s.replace(/[^\d.]/g, '');
      // معالجة وجود أكثر من نقطة
      const parts = s.split('.');
      if(parts.length > 2){ s = parts.shift() + '.' + parts.join(''); }
      const n = parseFloat(s);
      return isNaN(n) ? 0 : n;
    }

    // أسعار البيع (المبلغ بالـ USDT)
    const RATES = { YER: 518.95, SAR: 3.8, USD: 0.97 };

    const amountEl = document.getElementById('amount');
    const totalOut = document.getElementById('totalOut');
    const fmtEN = new Intl.NumberFormat('en-US',{useGrouping:false, maximumFractionDigits:2});

    function compute(){
      const qty  = normalizeNumber(amountEl.value); // USDT
      const rate = RATES[currency] || 0;
      const total = qty * rate;
      totalOut.value = qty>0 ? fmtEN.format(total) + ' ' + currency : '';
    }
    // حساب عند الكتابة، وعند فقدان التركيز، وعند اللصق
    ['input','change','keyup','paste'].forEach(ev=> amountEl.addEventListener(ev, compute));
    compute();

    // طرق التحويل (نفس المميزات)
    const methods = document.getElementById('methods');
    const dynamicBox = document.getElementById('dynamicBox');
    let method = '';

    const microTpl = {
      depositWithdraw: `
        <div class="box">
          <div class="toggle" id="dwToggle">
            <div class="opt active" data-type="إيداع إلى حساب">إيداع إلى حساب</div>
            <div class="opt" data-type="سحب نقدي">سحب نقدي</div>
          </div>
          <div id="dwContent" style="margin-top:10px"></div>
        </div>
      `,
      depositInfo: `
        <div class="box">
          <div class="row"><label>الاسم</label><div class="control"><input value="مجدي امين غالب المرقب" readonly /></div></div>
          <div class="row"><label>الرقم</label><div class="control"><input value="+967737311305" readonly /></div></div>
        </div>
      `,
      withdrawForm: `
        <div class="box grid grid-2">
          <div class="row"><label>رقم الهاتف</label><div class="control"><input id="wPhone" placeholder="7xxxxxxxx" inputmode="numeric" /></div></div>
          <div class="row"><label>المبلغ</label><div class="control"><input id="wAmount" type="number" min="0" step="0.01" placeholder="0" /></div></div>
          <div class="row"><label>الاسم</label><div class="control"><input id="wName" placeholder="اسم المستلم" /></div></div>
          <div class="row"><label>الرمز</label><div class="control"><input id="wCode" placeholder="الرمز" /></div></div>
        </div>
      `,
      kareemi: `
        <div class="box">
          <div class="row"><label>الاسم</label><div class="control"><input value="جمال علي علي البحري" readonly /></div></div>
          <div class="row"><label>يمني</label><div class="control"><input value="3111977738" readonly /></div></div>
          <div class="row"><label>سعودي</label><div class="control"><input value="3112270627" readonly /></div></div>
        </div>
      `,
      localTransfer: `
        <div class="box">
          <div class="row"><label>الاسم</label><div class="control"><input value="مجدي امين غالب احمد المرقب" readonly /></div></div>
          <div class="row"><label>الرقم</label><div class="control"><input value="+967781400883" readonly /></div></div>
        </div>
      `
    };

    methods.addEventListener('click', (e)=>{
      const p = e.target.closest('.pill'); if(!p) return;
      [...methods.children].forEach(x=>x.classList.remove('active')); p.classList.add('active');
      method = p.dataset.method;
      dynamicBox.style.display = 'block';

      if(['جوالي','جيب','ONEكاش','كاش','فلوسك'].includes(method)){
        dynamicBox.innerHTML = microTpl.depositWithdraw;
        const dwToggle = document.getElementById('dwToggle');
        const dwContent = document.getElementById('dwContent');
        const render = (type)=>{
          if(type==='إيداع إلى حساب') dwContent.innerHTML = microTpl.depositInfo; else dwContent.innerHTML = microTpl.withdrawForm;
        };
        render('إيداع إلى حساب');
        dwToggle.addEventListener('click', (ev)=>{
          const o = ev.target.closest('.opt'); if(!o) return;
          [...dwToggle.children].forEach(x=>x.classList.remove('active')); o.classList.add('active');
          render(o.dataset.type);
        });
      }
      else if(method==='كريمي'){
        dynamicBox.innerHTML = microTpl.kareemi;
      }
      else if(method==='حوالة محلي'){
        dynamicBox.innerHTML = microTpl.localTransfer;
      }
      else if(method==='تحويل مصرفي'){
        dynamicBox.innerHTML = '<div class="box">بيانات التحويل المصرفي تُستكمل لاحقاً.</div>';
      }
    });

    // تم التحويل + إكمال المعاملة + مشاركة واتساب
    const markPaid = document.getElementById('markPaid');
    const complete = document.getElementById('complete');
    const shareBox = document.getElementById('shareBox');
    const waWorkers = document.getElementById('waWorkers');
    const waMessenger = document.getElementById('waMessenger');
    const copyMsg = document.getElementById('copyMsg');

    let paid = false;
    markPaid.addEventListener('click', ()=>{
      paid = !paid; markPaid.textContent = paid? 'تم التحويل ✓' : 'تم التحويل';
      markPaid.classList.toggle('ok', paid);
    });

    function val(el, ok){ el.classList.remove('error'); if(ok) el.classList.add('ok'); }
    function err(el){ el.classList.add('error'); el.scrollIntoView({behavior:'smooth', block:'center'}); }

    // التحقق (يدعم أرقام عربية)
    function gather(){
      const name = document.getElementById('name');
      const cc = document.getElementById('cc');
      const phone = document.getElementById('phone');
      const amount = document.getElementById('amount');
      let okAll = true;

      if(!name.value.trim()){ err(name.parentElement); okAll=false; } else val(name.parentElement,1);
      if(!phone.value.trim()){ err(phone.parentElement); okAll=false; } else val(phone.parentElement,1);

      const amtNum = normalizeNumber(amount.value);
      if(!(amtNum>0)){ err(amount.parentElement); okAll=false; } else { val(amount.parentElement,1); amount.value = amtNum; }

      if(!method){ err(methods); okAll=false; }

      let w = {};
      if(['جوالي','جيب','ONEكاش','كاش','فلوسك'].includes(method)){
        const dw = document.querySelector('#dwToggle .opt.active');
        if(dw && dw.dataset.type==='سحب نقدي'){
          const wPhone = document.getElementById('wPhone');
          const wAmount = document.getElementById('wAmount');
          const wName = document.getElementById('wName');
          const wCode = document.getElementById('wCode');
          const wAmtNum = normalizeNumber(wAmount?.value);
          ['wPhone','wName','wCode'].forEach(id=>{
            const el = document.getElementById(id);
            if(!el || !el.value.trim()){ err(el.parentElement); okAll=false; } else val(el.parentElement,1);
          });
          if(!(wAmtNum>0)){ err(wAmount.parentElement); okAll=false; } else { val(wAmount.parentElement,1); wAmount.value = wAmtNum; }
          w = {wPhone:wPhone?.value||'', wAmount:wAmtNum||'', wName:wName?.value||'', wCode:wCode?.value||''};
        }
      }

      const data = {
        name: name.value.trim(),
        phone: cc.value + ' ' + phone.value.trim(),
        currency, amount: amtNum,
        method, paid, w
      };
      return {okAll, data};
    }

    function toMsg(d){
      let lines = [];
      lines.push('•© نوع العملية: بيع');
      lines.push('— الاسم: '+d.name);
      lines.push('— الهاتف: '+d.phone);
      lines.push('— العملة المحلية: '+d.currency);
      lines.push('— المبلغ (USDT): '+d.amount);
      lines.push('— طريقة التحويل: '+d.method);
      if(['جوالي','جيب','ONEكاش','كاش','فلوسك'].includes(d.method)){
        const opt = document.querySelector('#dwToggle .opt.active')?.dataset.type || 'إيداع إلى حساب';
        lines.push('— نوع العملية الفرعية: '+opt);
        if(opt==='إيداع إلى حساب'){
          lines.push('— الإيداع إلى: مجدي امين غالب المرقب / +967737311305');
        }else{
          lines.push('— سحب نقدي:');
          lines.push('   • الاسم: '+(d.w.wName||''));
          lines.push('   • الهاتف: '+(d.w.wPhone||''));
          lines.push('   • المبلغ: '+(d.w.wAmount||''));
          lines.push('   • الرمز: '+(d.w.wCode||''));
        }
      }
      if(d.method==='كريمي'){
        lines.push('— كريمي: جمال علي علي البحري / يمني 3111977738 / سعودي 3112270627');
      }
      if(d.method==='حوالة محلي'){
        lines.push('— حوالة محلي: +967781400883 / مجدي امين غالب احمد المرقب');
      }
      lines.push('— تم التحويل: '+ (d.paid? 'نعم' : 'لا'));
      return lines.join('\n');
    }

    complete.addEventListener('click', ()=>{
      const {okAll, data} = gather();
      if(!okAll){ alert('يرجى إكمال الحقول المطلوبة.'); return; }
      const shareBox = document.getElementById('shareBox');
      shareBox.style.display = 'flex';
      const msg = toMsg(data);
      const waNum = '967781400883';
      const url = `https://wa.me/${waNum}?text=${encodeURIComponent(msg)}`;
      document.getElementById('waWorkers').onclick = ()=> window.open(url, '_blank');
      document.getElementById('waMessenger').onclick = ()=> window.open(url, '_blank');
      document.getElementById('copyMsg').onclick = async ()=>{ try{ await navigator.clipboard.writeText(msg); copyMsg.textContent='تم النسخ'; setTimeout(()=>copyMsg.textContent='نسخ التفاصيل',1200);}catch(e){ alert('انسخ يدويًا:\n\n'+msg) } };
    });
  </script>
</body>
</html>